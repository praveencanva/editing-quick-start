{"version":3,"sources":["node_modules/@canva/editing-extensions-api/dist/errors.js","node_modules/@canva/editing-extensions-api/dist/event_handler.js","node_modules/@canva/editing-extensions-api/dist/mailbox.js","node_modules/@canva/editing-extensions-api/dist/iframe_client_comms.js","node_modules/@canva/editing-extensions-api/dist/canva_api_client.js","node_modules/@canva/editing-extensions-api/dist/canva_image.js","node_modules/@canva/editing-extensions-api/dist/control_kit/base.js","node_modules/@canva/editing-extensions-api/dist/control_kit/slider.js","node_modules/@canva/editing-extensions-api/dist/control_kit/button.js","node_modules/@canva/editing-extensions-api/dist/control_kit/group.js","node_modules/@canva/editing-extensions-api/dist/control_kit/select.js","node_modules/@canva/editing-extensions-api/dist/control_kit/radio-group.js","node_modules/@canva/editing-extensions-api/dist/control_kit/text_input.js","node_modules/@canva/editing-extensions-api/dist/control_kit/checkbox.js","node_modules/@canva/editing-extensions-api/dist/control_kit/paragraph.js","node_modules/@canva/editing-extensions-api/dist/control_kit/control_kit.js","node_modules/@canva/editing-extensions-api/dist/control_kit/preview_overlay.js","node_modules/@canva/editing-extensions-api/dist/control_kit/thumbnail_list.js","node_modules/@canva/editing-extensions-api/dist/canva_api.js","node_modules/@canva/editing-extensions-api/dist/host/host_bus.js","node_modules/@canva/editing-extensions-api/dist/host/iframe_host_comms.js","node_modules/@canva/editing-extensions-api/dist/host/iframe_connection.js","node_modules/@canva/editing-extensions-api/dist/index.js","controls.js","events.js","node_modules/watermarkjs/dist/watermark.js","index.js","../../../../usr/local/lib/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["renderSettings","state","text","watermarkPostion","size","color","opacity","Paragraph","create","id","Group","label","children","RadioGroup","value","buttons","TextInput","inputType","Slider","min","max","step","ColorPicker","controlsEventsHandler","event","controlId","message","prevState","context","canvas","CanvaApiClient","initialize","canva","renderControls","updateControlPanel","Page","controls","render","console","log","opts","image","CanvaImage","toImageElement","watermark","then","drawImage","width","height","setInterval","info","onReady","document","createElement","style","body","appendChild","getContext","onControlsEvent","onSaveRequest","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","data","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","JSON","parse","type","handled","assets","forEach","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","clear","hmrApply","v","hmrAcceptRun","reload","close","onclose","removeErrorOverlay","error","stack","overlay","createErrorOverlay","getElementById","remove","stackTrace","innerText","innerHTML","getParents","modules","parents","k","d","dep","Array","isArray","length","concat","Function","deps","cached","cache","some","cb"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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","file":"editing-quick-start.e31bb0bc.js","sourceRoot":"..","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * @alpha\n */\nclass UnreachableError {\n    constructor(description, message) {\n        console.error(`UnreachableError (${description})`, message);\n    }\n}\nexports.UnreachableError = UnreachableError;\n/**\n * @alpha\n */\nclass UnimplementedError extends Error {\n}\nexports.UnimplementedError = UnimplementedError;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * @internal\n */\nclass EventHandler {\n    constructor() {\n        this.handlers = new Set();\n    }\n    addEventListener(handler) {\n        this.handlers.add(handler);\n    }\n    removeEventListener(handler) {\n        this.handlers.delete(handler);\n    }\n    emit(...args) {\n        return this.handlers.forEach(f => f(...args));\n    }\n}\nexports.EventHandler = EventHandler;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * @internal\n */\nvar Envelope;\n(function (Envelope) {\n    class Minter {\n        constructor() {\n            this.nextEnvelopeId = 0;\n        }\n        mint(content, responseToId) {\n            return {\n                id: this.nextEnvelopeId++,\n                content,\n                responseToId,\n            };\n        }\n    }\n    Envelope.Minter = Minter;\n})(Envelope = exports.Envelope || (exports.Envelope = {}));\n/**\n * A mailbox for buffering messages. Add messages to the mailbox with\n * `enqueueMessage`, and pull them out of the mailbox with `receiveReply` or\n * `receiveMany`.\n *\n * Messages are kept in the mailbox until it is full, at which\n * point the oldest messages are removed to limit the size. The size of the\n * mailbox can be specified in the constructor.\n * @internal\n */\nclass Mailbox {\n    constructor(opts) {\n        this.opts = opts;\n        this.handlers = new Set();\n        this.messages = [];\n    }\n    /**\n     * Returns a Promise that resolves when the given message type\n     * is received. If the message is already in the mailbox, the\n     * promise will resolve immediately, otherwise it will continue\n     * to listen until a matching message is received.\n     */\n    receiveReply(envelopeId, timeout) {\n        // Scan mailbox for any existing matching messages\n        for (const [i, msg] of this.messages.entries()) {\n            if (msg.responseToId === envelopeId) {\n                // Remove message from mailbox since it's handled\n                this.messages.splice(i, 1);\n                return Promise.resolve(msg);\n            }\n        }\n        // Wait until matching message is received\n        const receivePromise = new Promise(resolve => {\n            const handler = (msg) => {\n                if (msg.responseToId === envelopeId) {\n                    this.handlers.delete(handler);\n                    resolve(msg);\n                    return true;\n                }\n                return false;\n            };\n            this.handlers.add(handler);\n        });\n        const timeoutPromise = new Promise((resolve, reject) => {\n            setTimeout(() => {\n                reject(new Error('Mailbox timed out waiting for reply'));\n            }, timeout || this.opts.timeout);\n        });\n        return Promise.race([receivePromise, timeoutPromise]);\n    }\n    /**\n     * Send a message and let any receivers pick it up\n     */\n    enqueueMessage(msg) {\n        // Is there already a handler that matches this message?\n        for (const handler of this.handlers.values()) {\n            if (handler(msg)) {\n                // Handler handled this message\n                return;\n            }\n        }\n        // No current handlers, save the message in the mailbox for later\n        this.messages.push(msg);\n        if (this.messages.length > this.opts.bufferSize) {\n            this.messages.shift();\n        }\n    }\n}\nexports.Mailbox = Mailbox;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst event_handler_1 = require(\"./event_handler\");\nconst mailbox_1 = require(\"./mailbox\");\n/**\n * @internal\n */\nclass IFrameClientBusComms {\n    constructor(port) {\n        this.port = port;\n        this.envelopeMinter = new mailbox_1.Envelope.Minter();\n        this.mailbox = new mailbox_1.Mailbox({\n            bufferSize: IFrameClientBusComms.MAILBOX_BUFFER_SIZE,\n            timeout: IFrameClientBusComms.MESSAGING_TIMEOUT,\n        });\n        this.messageHandler = new event_handler_1.EventHandler();\n        this.onPortMessage = (event) => {\n            // console.log('[Client] Receiving event =', event);\n            const message = event.data;\n            if (message.responseToId != null) {\n                this.mailbox.enqueueMessage(message);\n            }\n            this.messageHandler.emit(event);\n        };\n        this.port.onmessage = this.onPortMessage;\n    }\n    onMessage(handler) {\n        this.messageHandler.addEventListener((event) => __awaiter(this, void 0, void 0, function* () {\n            const message = event.data;\n            if (message.responseToId == null) {\n                const response = yield handler(message.content);\n                if (response) {\n                    this.respondTo(response, message.id);\n                }\n            }\n        }));\n    }\n    castMessage(msg) {\n        this.port.postMessage(this.envelopeMinter.mint(msg));\n    }\n    sendMessage(msg, timeout) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const envelope = this.envelopeMinter.mint(msg);\n            // console.log('[Client] Sending Envelope =', envelope);\n            this.port.postMessage(envelope);\n            const response = yield this.mailbox.receiveReply(envelope.id, timeout);\n            return response.content;\n        });\n    }\n    respondTo(message, responseToId) {\n        this.port.postMessage(this.envelopeMinter.mint(message, responseToId));\n    }\n}\nexports.IFrameClientBusComms = IFrameClientBusComms;\nIFrameClientBusComms.MAILBOX_BUFFER_SIZE = 5;\nIFrameClientBusComms.MESSAGING_TIMEOUT = 5000;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst errors_1 = require(\"./errors\");\nconst iframe_client_comms_1 = require(\"./iframe_client_comms\");\n/**\n * API client provided to devs for use in their app iframes\n * Reduces boilerplate when interacting with host iFrame\n */\nclass CanvaApiClient {\n    constructor(comms) {\n        this.comms = comms;\n        this.remoteProcessCounter = 0;\n        this.onReceiveMessage = (message) => __awaiter(this, void 0, void 0, function* () {\n            // if the app has called exit() then don't send it any messages, but we can respond\n            // to a save request in case messages got out of order over the wire\n            if (this.exitingWithImage) {\n                if (message.topic === \"save_request\" /* SAVE_REQUEST */) {\n                    return Promise.resolve({\n                        topic: \"save_response\" /* SAVE_RESPONSE */,\n                        image: this.exitingWithImage,\n                    });\n                }\n                return;\n            }\n            switch (message.topic) {\n                case \"controls_event\" /* CONTROLS_EVENT */:\n                    return this.handleControlsEvent(message);\n                case \"image_update\" /* IMAGE_UPDATE */:\n                    return this.handleImageUpdate(message);\n                case \"viewport_resize\" /* VIEWPORT_RESIZE */:\n                    return this.handleViewportResize(message);\n                case \"save_request\" /* SAVE_REQUEST */:\n                    return this.handleSaveRequest();\n                case \"init_request\" /* INIT_REQUEST */:\n                    return this.handleInitRequest(message);\n                case \"remote_process_started\" /* REMOTE_PROCESS_STARTED */:\n                case \"remote_process_progress\" /* REMOTE_PROCESS_PROGRESS */:\n                case \"remote_process_complete\" /* REMOTE_PROCESS_COMPLETE */:\n                    // console.log(`[Client] receieved ${message.topic}`);\n                    if (this.remoteProcessStateMachine &&\n                        message.processId === this.remoteProcessCounter) {\n                        return this.remoteProcessStateMachine.receive(message);\n                    }\n                    else {\n                        throw new Error(`Unsolicited ${message.topic} message received processId: ${message.processId}`);\n                    }\n                    break;\n                case \"presets_request\" /* PRESETS_REQUEST */:\n                    return this.handlePresetsRequest(message);\n                case \"preset_selected\" /* PRESET_SELECTED */:\n                    return this.handlePresetSelected(message);\n                default:\n                    throw new errors_1.UnreachableError('Unknown message type', message);\n            }\n        });\n        this.comms = comms;\n        this.comms.onMessage(this.onReceiveMessage);\n    }\n    static initialize(handler) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const messageChannel = new MessageChannel();\n            const comms = new iframe_client_comms_1.IFrameClientBusComms(messageChannel.port1);\n            const api = new CanvaApiClient(comms);\n            yield handler(api);\n            this.sendWakeUp(messageChannel.port2);\n            return;\n        });\n    }\n    /**\n     * @internal\n     */\n    static sendWakeUp(port) {\n        // console.log('[Client] Sending WAKE_UP event');\n        window.parent.postMessage({\n            topic: \"wake_up\" /* WAKE_UP */,\n        }, '*', [port]);\n    }\n    /**\n     * This function registers a callback that initializes an app.\n     * @param handler Function that initializes an app. Both synchronous and asynchronous functions are supported.\n     * @alpha\n     */\n    onReady(handler) {\n        // console.log('setting onReady handler');\n        this.readyHandler = handler;\n    }\n    /**\n     * @alpha\n     */\n    onControlsEvent(handler) {\n        // console.log('setting onControlsEvent handler');\n        this.controlsEventHandler = handler;\n    }\n    /**\n     * @alpha\n     */\n    onPresetsRequest(handler) {\n        this.presetsRequestHandler = handler;\n    }\n    /**\n     * @alpha\n     */\n    onPresetSelected(handler) {\n        this.presetSelectedHandler = handler;\n    }\n    /**\n     * @alpha\n     */\n    onSaveRequest(handler) {\n        this.saveRequestHandler = handler;\n    }\n    /**\n     * @alpha\n     */\n    onImageUpdate(handler) {\n        if (this.imageUpdateHandler) {\n            throw new Error('ImageUpdateHandler event handler has already been defined');\n        }\n        this.imageUpdateHandler = handler;\n    }\n    /**\n     * @alpha\n     */\n    onViewportResize(handler) {\n        if (this.viewportResizeHandler) {\n            throw new Error('ViewportResize event handler has already been defined');\n        }\n        this.viewportResizeHandler = handler;\n    }\n    handleInitRequest(message) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                // console.log('[Client] Received INIT_REQUEST');\n                if (this.readyHandler) {\n                    const { topic } = message, options = __rest(message, [\"topic\"]);\n                    yield this.readyHandler(options);\n                }\n                // console.log('[Client] Sending INIT_RESPONSE');\n                return {\n                    topic: \"init_response\" /* INIT_RESPONSE */,\n                };\n            }\n            catch (e) {\n                // TODO Report the error\n                console.error('[Client] Cannot run the extension:', e.message);\n                console.error(e);\n                // console.log('[Client] Sending INIT_RESPONSE (error = true)');\n                return {\n                    topic: \"init_response\" /* INIT_RESPONSE */,\n                    error: true,\n                };\n            }\n        });\n    }\n    overrideThumbnail(thumbnailId, thumbnail) {\n        this.comms.castMessage({\n            topic: \"thumbnail_override\" /* THUMBNAIL_OVERRIDE */,\n            thumbnailId,\n            thumbnail,\n        });\n    }\n    updateControlPanel(controls, overlay) {\n        this.comms.castMessage({\n            topic: \"controls_render\" /* CONTROLS_RENDER */,\n            controls,\n            overlay,\n        });\n    }\n    handleControlsEvent(message) {\n        if (this.controlsEventHandler) {\n            this.controlsEventHandler(message.message);\n        }\n    }\n    handleImageUpdate(message) {\n        const { image } = message;\n        if (this.imageUpdateHandler) {\n            this.imageUpdateHandler(image);\n        }\n    }\n    handleViewportResize(message) {\n        const { size, commit } = message;\n        if (this.viewportResizeHandler) {\n            this.viewportResizeHandler(size, commit);\n        }\n    }\n    handleSaveRequest() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.saveRequestHandler) {\n                throw new Error('Received save request, but no handler configured.');\n            }\n            const image = yield this.saveRequestHandler();\n            return {\n                topic: \"save_response\" /* SAVE_RESPONSE */,\n                image,\n            };\n        });\n    }\n    handlePresetsRequest(message) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.presetsRequestHandler) {\n                throw new Error('Received presets request, but no handler configured.');\n            }\n            const presets = yield this.presetsRequestHandler({\n                minDimensions: message.minDimensions,\n                image: message.image,\n            });\n            return {\n                topic: \"presets_response\" /* PRESETS_RESPONSE */,\n                presets,\n            };\n        });\n    }\n    handlePresetSelected(message) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.presetSelectedHandler) {\n                return;\n            }\n            this.presetSelectedHandler({ presetId: message.presetId });\n        });\n    }\n    /**\n     * @internal Remote processes aren't yet supported by third-party apps\n     */\n    remoteProcess(input, progressHandler, idHandler) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise((resolve, reject) => {\n                const onStart = (started) => idHandler && idHandler(started.inputImageId);\n                const onProgress = (progress) => progressHandler &&\n                    progressHandler(progress.label, progress.done, progress.total);\n                const onComplete = (complete) => complete.result ? resolve(complete.result) : reject(complete.error);\n                this.remoteProcessStateMachine = new RemoteProcessStateMachine(onStart, onProgress, onComplete);\n                // console.log('[Client] sending START_REMOTE_PROCESS');\n                this.comms.castMessage({\n                    topic: \"start_remote_process\" /* START_REMOTE_PROCESS */,\n                    processId: ++this.remoteProcessCounter,\n                    input,\n                });\n            });\n        });\n    }\n    /**\n     * @alpha\n     */\n    exit(image) {\n        this.exitingWithImage = image;\n        this.comms.castMessage({\n            topic: \"exit\" /* EXIT */,\n            image,\n        });\n    }\n}\nexports.CanvaApiClient = CanvaApiClient;\nclass RemoteProcessStateMachine {\n    constructor(onStart, onProgress, onComplete) {\n        this.onStart = onStart;\n        this.onProgress = onProgress;\n        this.onComplete = onComplete;\n        this.state = 'READY';\n        this.startedMessage = undefined;\n        this.progressMessages = [];\n        this.completeMessage = undefined;\n    }\n    receive(message) {\n        switch (message.topic) {\n            case \"remote_process_started\" /* REMOTE_PROCESS_STARTED */:\n                if (this.startedMessage) {\n                    throw new Error(`Receieved too many ${message.topic} messages`);\n                }\n                this.startedMessage = message;\n                break;\n            case \"remote_process_progress\" /* REMOTE_PROCESS_PROGRESS */:\n                this.progressMessages.push(message);\n                break;\n            case \"remote_process_complete\" /* REMOTE_PROCESS_COMPLETE */:\n                if (this.completeMessage) {\n                    throw new Error(`Receieved too many ${message.topic} messages`);\n                }\n                this.completeMessage = message;\n                break;\n            default:\n                throw new errors_1.UnreachableError('Unknown message type', message);\n        }\n        this.handleMessages();\n    }\n    handleMessages() {\n        switch (this.state) {\n            case 'READY':\n                if (this.startedMessage) {\n                    this.onStart(this.startedMessage);\n                    this.state = 'STARTED';\n                    this.handleMessages();\n                }\n                break;\n            case 'STARTED':\n                if (this.progressMessages.length > 0) {\n                    this.onProgress(this.progressMessages[0]);\n                    this.progressMessages.shift();\n                    this.handleMessages();\n                }\n                else if (this.completeMessage) {\n                    this.onComplete(this.completeMessage);\n                    this.state = 'DONE';\n                }\n                break;\n            case 'DONE':\n                // do nothing\n                break;\n            default:\n                throw new errors_1.UnreachableError('Unknown state', this.state);\n        }\n    }\n}\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// Edge doesn't support `toBlob`. Implementation below based on\n// https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob#Polyfill\nconst canvasToBlob = (canvas, type, quality) => __awaiter(void 0, void 0, void 0, function* () {\n    // use native canvas.toBlob, if available\n    if (typeof canvas.toBlob === 'function') {\n        const blob = yield new Promise((resolve, reject) => {\n            try {\n                canvas.toBlob(b => (b instanceof Blob ? resolve(b) : reject(b)), type, quality);\n            }\n            catch (e) {\n                reject(e);\n            }\n        });\n        return blob;\n    }\n    // roll this manually with a dataURL\n    const dataUrl = canvas.toDataURL(type, quality).split(',')[1];\n    const binStr = atob(dataUrl);\n    const len = binStr.length;\n    const arr = new Uint8Array(len);\n    for (let i = 0; i < len; i++) {\n        arr[i] = binStr.charCodeAt(i);\n    }\n    return new Blob([arr], { type: type || 'image/png' });\n});\n// From: https://stackoverflow.com/questions/12168909/blob-from-dataurl\n// TODO(Jordan): Handle cases were URI is malformed\nfunction dataURItoBlob(dataURI) {\n    // convert base64 to raw binary data held in a string\n    // doesn't handle URLEncoded DataURIs - see SO answer #6850276 for code that does this\n    const byteString = atob(dataURI.split(',')[1]);\n    // separate out the mime component\n    const mimeString = dataURI\n        .split(',')[0]\n        .split(':')[1]\n        .split(';')[0];\n    // write the bytes of the string to an ArrayBuffer\n    const ab = new ArrayBuffer(byteString.length);\n    // create a view into the buffer\n    const ia = new Uint8Array(ab);\n    // set the bytes of the buffer to the correct values\n    for (let i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i);\n    }\n    // write the ArrayBuffer to a blob, and you're done\n    return new Blob([ab], { type: mimeString });\n}\nconst isSafari = navigator &&\n    navigator.userAgent.match(/chrome/i) &&\n    navigator.userAgent.match(/safari/i);\nconst blobToImage = (blob) => {\n    return isSafari ? blobToImageViaReader(blob) : blobToImageViaObjectUrl(blob);\n};\n// slow path for Safari - it seems to have troubles with `createObjectURL` and race conditions\n// `WebKitBlobResource error 1`\nconst blobToImageViaReader = (blob) => {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = function () {\n            if (reader && reader.result instanceof ArrayBuffer) {\n                const arrayBuffToImage = blobToImageViaObjectUrl(new Blob([new Uint8Array(reader.result)], { type: blob.type }));\n                resolve(arrayBuffToImage);\n            }\n            else {\n                reject('unknown error');\n            }\n        };\n        reader.onerror = e => reject(e);\n        reader.readAsArrayBuffer(blob);\n    });\n};\nconst blobToImageViaObjectUrl = (blob) => {\n    return new Promise((resolve, reject) => {\n        const image = new Image();\n        image.crossOrigin = 'anonymous';\n        const url = URL.createObjectURL(blob);\n        image.onload = () => {\n            resolve(image);\n            URL.revokeObjectURL(url);\n        };\n        image.onerror = () => {\n            console.error('blobToImage', 'failed');\n            reject('Could not load image');\n        };\n        image.src = url;\n    });\n};\n/**\n * @alpha\n */\nvar CanvaImage;\n(function (CanvaImage) {\n    CanvaImage.fromCanvas = (imageType, canvas, quality) => __awaiter(this, void 0, void 0, function* () {\n        const blob = yield canvasToBlob(canvas, imageType, quality);\n        if (blob instanceof Blob) {\n            // console.log('blob resolve');\n            const { width, height } = canvas;\n            return { blob, imageType, width, height };\n        }\n        throw new Error('Could not create Blob from Canvas');\n    });\n    CanvaImage.fromDataUrl = (imageType, dataUrl) => __awaiter(this, void 0, void 0, function* () {\n        const blob = dataURItoBlob(dataUrl);\n        const { width, height } = yield blobToImage(blob);\n        return {\n            blob,\n            imageType,\n            width,\n            height,\n        };\n    });\n    CanvaImage.fromUrl = (url) => __awaiter(this, void 0, void 0, function* () {\n        const response = yield fetch(url);\n        const blob = yield response.blob();\n        const imageType = blob.type;\n        const { width, height } = yield blobToImage(blob);\n        return {\n            blob,\n            imageType,\n            width,\n            height,\n        };\n    });\n    CanvaImage.toImageElement = (t) => blobToImage(t.blob);\n    CanvaImage.toDataUrl = (t) => {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = e => {\n                if (reader.result && typeof reader.result === 'string') {\n                    resolve(reader.result);\n                }\n                else {\n                    reject('Unexpected FileReader result');\n                }\n            };\n            reader.onerror = () => {\n                reject('Error loading blob');\n            };\n            reader.readAsDataURL(t.blob);\n        });\n    };\n    CanvaImage.getSize = (t) => ({\n        width: t.width,\n        height: t.height,\n    });\n})(CanvaImage = exports.CanvaImage || (exports.CanvaImage = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ControlName;\n(function (ControlName) {\n    ControlName[\"BUTTON\"] = \"button\";\n    ControlName[\"COLOR_PICKER\"] = \"color_picker\";\n    ControlName[\"PAGE\"] = \"control_panel\";\n    ControlName[\"GROUP\"] = \"group\";\n    ControlName[\"SELECT\"] = \"select\";\n    ControlName[\"SLIDER\"] = \"slider\";\n    ControlName[\"THUMBNAIL_LIST\"] = \"thumbnail_list\";\n    ControlName[\"TEXT_INPUT\"] = \"text_input\";\n    ControlName[\"CHECKBOX\"] = \"checkbox\";\n    ControlName[\"PARAGRAPH\"] = \"paragraph\";\n    ControlName[\"RADIO_GROUP\"] = \"radio_group\";\n})(ControlName = exports.ControlName || (exports.ControlName = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Slider;\n(function (Slider) {\n    Slider.create = (props) => (Object.assign({ type: \"slider\" /* SLIDER */ }, props));\n})(Slider = exports.Slider || (exports.Slider = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Button;\n(function (Button) {\n    Button.create = (props) => (Object.assign({ type: \"button\" /* BUTTON */ }, props));\n})(Button = exports.Button || (exports.Button = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Group;\n(function (Group) {\n    Group.create = (props) => (Object.assign({ type: \"group\" /* GROUP */ }, props));\n})(Group = exports.Group || (exports.Group = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Select;\n(function (Select) {\n    Select.create = (props) => (Object.assign({ type: \"select\" /* SELECT */ }, props));\n})(Select = exports.Select || (exports.Select = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar RadioGroup;\n(function (RadioGroup) {\n    RadioGroup.create = (props) => (Object.assign({ type: \"radio_group\" /* RADIO_GROUP */ }, props));\n})(RadioGroup = exports.RadioGroup || (exports.RadioGroup = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar TextInput;\n(function (TextInput) {\n    TextInput.create = (props) => {\n        return Object.assign({ type: \"text_input\" /* TEXT_INPUT */ }, props);\n    };\n})(TextInput = exports.TextInput || (exports.TextInput = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Checkbox;\n(function (Checkbox) {\n    Checkbox.create = (props) => (Object.assign({ type: \"checkbox\" /* CHECKBOX */ }, props));\n})(Checkbox = exports.Checkbox || (exports.Checkbox = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Paragraph;\n(function (Paragraph) {\n    Paragraph.create = (props) => (Object.assign({ type: \"paragraph\" /* PARAGRAPH */ }, props));\n})(Paragraph = exports.Paragraph || (exports.Paragraph = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_1 = require(\"./base\");\nexports.ControlName = base_1.ControlName;\nvar slider_1 = require(\"./slider\");\nexports.Slider = slider_1.Slider;\nvar button_1 = require(\"./button\");\nexports.Button = button_1.Button;\nvar group_1 = require(\"./group\");\nexports.Group = group_1.Group;\nvar select_1 = require(\"./select\");\nexports.Select = select_1.Select;\nvar radio_group_1 = require(\"./radio-group\");\nexports.RadioGroup = radio_group_1.RadioGroup;\nvar text_input_1 = require(\"./text_input\");\nexports.TextInput = text_input_1.TextInput;\nvar checkbox_1 = require(\"./checkbox\");\nexports.Checkbox = checkbox_1.Checkbox;\nvar paragraph_1 = require(\"./paragraph\");\nexports.Paragraph = paragraph_1.Paragraph;\n// TODO move these to their own .ts file\nvar ColorPicker;\n(function (ColorPicker) {\n    ColorPicker.create = (props) => (Object.assign({ type: \"color_picker\" /* COLOR_PICKER */ }, props));\n})(ColorPicker = exports.ColorPicker || (exports.ColorPicker = {}));\nvar Page;\n(function (Page) {\n    /**\n     * @param controls List of controls to show in the page\n     * @param subpage (Optional) Whether the app receives the back button event\n     * @param title (Optional) i18n'd title shown in subpage header\n     * @param action (Optional) i18n'd action shown in subpage header\n     */\n    Page.create = ({ subpage, title, actionLabel, controls, }) => {\n        return subpage\n            ? {\n                type: \"control_panel\" /* PAGE */,\n                id: 'control_panel',\n                subpage: true,\n                title,\n                actionLabel,\n                controls,\n            }\n            : {\n                type: \"control_panel\" /* PAGE */,\n                id: 'control_panel',\n                subpage: false,\n                controls,\n            };\n    };\n})(Page = exports.Page || (exports.Page = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar PreviewOverlay;\n(function (PreviewOverlay) {\n    PreviewOverlay.type = 'PREVIEW_OVERLAY';\n    let NotificationType;\n    (function (NotificationType) {\n        NotificationType[\"SUCCESS\"] = \"success\";\n        NotificationType[\"ERROR\"] = \"error\";\n        NotificationType[\"INFO\"] = \"info\";\n    })(NotificationType = PreviewOverlay.NotificationType || (PreviewOverlay.NotificationType = {}));\n    PreviewOverlay.create = (props) => (Object.assign({ type: PreviewOverlay.type }, props));\n})(PreviewOverlay = exports.PreviewOverlay || (exports.PreviewOverlay = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ThumbnailId;\n(function (ThumbnailId) {\n    ThumbnailId.create = (id) => id;\n})(ThumbnailId = exports.ThumbnailId || (exports.ThumbnailId = {}));\nvar ThumbnailList;\n(function (ThumbnailList) {\n    ThumbnailList.create = (props) => (Object.assign({ type: \"thumbnail_list\" /* THUMBNAIL_LIST */ }, props));\n})(ThumbnailList = exports.ThumbnailList || (exports.ThumbnailList = {}));\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Message;\n(function (Message) {\n    let Topic;\n    (function (Topic) {\n        Topic[\"WAKE_UP\"] = \"wake_up\";\n        // Initial setup\n        Topic[\"INIT_REQUEST\"] = \"init_request\";\n        Topic[\"INIT_RESPONSE\"] = \"init_response\";\n        // Canva requests presets\n        Topic[\"PRESETS_REQUEST\"] = \"presets_request\";\n        Topic[\"PRESETS_RESPONSE\"] = \"presets_response\";\n        // A preset was selected by the user; let the app know\n        Topic[\"PRESET_SELECTED\"] = \"preset_selected\";\n        // Sending the controls and managing their state\n        Topic[\"CONTROLS_RENDER\"] = \"controls_render\";\n        Topic[\"CONTROLS_EVENT\"] = \"controls_event\";\n        Topic[\"THUMBNAIL_OVERRIDE\"] = \"thumbnail_override\";\n        // Sending a new image for the app to use\n        Topic[\"IMAGE_UPDATE\"] = \"image_update\";\n        // Resizing the viewport\n        Topic[\"VIEWPORT_RESIZE\"] = \"viewport_resize\";\n        // Sending a rendered image from the app\n        Topic[\"SAVE_REQUEST\"] = \"save_request\";\n        Topic[\"SAVE_RESPONSE\"] = \"save_response\";\n        // Process an image using the server\n        Topic[\"START_REMOTE_PROCESS\"] = \"start_remote_process\";\n        Topic[\"REMOTE_PROCESS_STARTED\"] = \"remote_process_started\";\n        Topic[\"REMOTE_PROCESS_PROGRESS\"] = \"remote_process_progress\";\n        Topic[\"REMOTE_PROCESS_COMPLETE\"] = \"remote_process_complete\";\n        // The app is done and wants to exit\n        Topic[\"EXIT\"] = \"exit\";\n    })(Topic = Message.Topic || (Message.Topic = {}));\n})(Message = exports.Message || (exports.Message = {}));\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst __1 = require(\"../\");\nclass HostBus {\n    constructor({ comms }) {\n        // Amount of time an app is given to respond with an image\n        this.SAVE_TIMEOUT = 20000;\n        this.seq = 0;\n        this.thumbnailOverrideHandler = new __1.EventHandler();\n        this.controlsRenderHandler = new __1.EventHandler();\n        this.saveRequested = false;\n        /**\n         * Handle incoming messages from iframes belonging to the dev.\n         */\n        this.onReceiveMessage = (message) => __awaiter(this, void 0, void 0, function* () {\n            switch (message.topic) {\n                case \"controls_render\" /* CONTROLS_RENDER */:\n                    // console.log('[Host] Received CONTROLS_RENDER');\n                    this.controlsRenderHandler.emit(this.seq++, message.controls, message.overlay);\n                    break;\n                case \"thumbnail_override\" /* THUMBNAIL_OVERRIDE */:\n                    // console.log('[Host] Received THUMBNAIL_OVERRIDE');\n                    this.thumbnailOverrideHandler.emit(message.thumbnailId, message.thumbnail);\n                    break;\n                case \"start_remote_process\" /* START_REMOTE_PROCESS */:\n                    // console.log('[Host] Received START_REMOTE_PROCESS');\n                    this.handleStartRemoteProcess(message);\n                    break;\n                case \"exit\" /* EXIT */:\n                    // console.log('[Host] Received EXIT');\n                    this.handleExit(message);\n                    break;\n                case \"init_response\" /* INIT_RESPONSE */:\n                case \"save_response\" /* SAVE_RESPONSE */:\n                case \"presets_response\" /* PRESETS_RESPONSE */:\n                    throw new Error(`Unsolicited ${message.topic} response received`);\n                default:\n                    throw new __1.UnreachableError('Unknown message type', message);\n            }\n        });\n        this.comms = comms;\n        comms.onMessage(this.onReceiveMessage);\n    }\n    sendInitMessage(options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // console.log('[Host] Sending INIT_REQUEST');\n            const response = yield this.comms.sendMessage(Object.assign({ topic: \"init_request\" /* INIT_REQUEST */ }, options));\n            if (response.error) {\n                throw new Error('Could not initialize the app');\n            }\n        });\n    }\n    sendControlsEvent(msg) {\n        // console.log('[Host] Sending CONTROLS_EVENT');\n        this.comms.castMessage({\n            topic: \"controls_event\" /* CONTROLS_EVENT */,\n            message: msg,\n        });\n    }\n    sendViewportResize(size, commit) {\n        // console.log('[Host] Sending VIEWPORT_RESIZE');\n        this.comms.castMessage({\n            topic: \"viewport_resize\" /* VIEWPORT_RESIZE */,\n            commit,\n            size,\n        });\n    }\n    sendImageUpdate(image) {\n        // console.log('[Host] Sending IMAGE_UPDATE');\n        this.comms.castMessage({\n            topic: \"image_update\" /* IMAGE_UPDATE */,\n            image,\n        });\n    }\n    // TODO: Add deserialize for type safety\n    sendSaveRequest() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // console.log('[Host] Sending SAVE_REQUEST');\n            this.saveRequested = true;\n            const response = yield this.comms.sendMessage({\n                topic: \"save_request\" /* SAVE_REQUEST */,\n            }, this.SAVE_TIMEOUT);\n            return response.image;\n        });\n    }\n    onOverrideThumbnail(handler) {\n        this.thumbnailOverrideHandler.addEventListener(handler);\n    }\n    onUpdateControlPanel(handler) {\n        this.controlsRenderHandler.addEventListener(handler);\n    }\n    onRemoteProcess(handler) {\n        this.remoteProcessHandler = handler;\n    }\n    onExit(handler) {\n        this.exitHandler = handler;\n    }\n    sendPresetsRequest(image, minDimensions) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const response = yield this.comms.sendMessage({\n                topic: \"presets_request\" /* PRESETS_REQUEST */,\n                minDimensions,\n                image,\n            });\n            return response.presets;\n        });\n    }\n    sendPresetSelected(presetId) {\n        this.comms.castMessage({\n            topic: \"preset_selected\" /* PRESET_SELECTED */,\n            presetId,\n        });\n    }\n    handleStartRemoteProcess(message) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { processId, input } = message;\n            if (!this.remoteProcessHandler) {\n                throw new Error('Received remote process request with no handler registered');\n            }\n            // console.log(`[Host] Received START_REMOTE_PROCESS processId: ${processId}`);\n            // receive progress from the remoteProcessHandler and cast it to the comms\n            const progressHandler = (label, done, total) => {\n                // console.log(`[Host] Received REMOTE_PROCESS_PROGRESS processId: ${processId}`);\n                this.comms.castMessage({\n                    topic: \"remote_process_progress\" /* REMOTE_PROCESS_PROGRESS */,\n                    processId,\n                    label,\n                    done,\n                    total,\n                });\n            };\n            const { inputImageId: inputImageIdPromise, result: resultPromise, } = this.remoteProcessHandler(input, progressHandler);\n            // console.log(`[Host] Sending REMOTE_PROCESS_STARTED processId: ${processId}`);\n            const inputImageId = yield inputImageIdPromise;\n            this.comms.castMessage({\n                topic: \"remote_process_started\" /* REMOTE_PROCESS_STARTED */,\n                processId,\n                inputImageId,\n            });\n            try {\n                // console.log(`[Host] Sending REMOTE_PROCESS_COMPLETE (success) processId: ${processId}`);\n                const result = yield resultPromise;\n                this.comms.castMessage({\n                    topic: \"remote_process_complete\" /* REMOTE_PROCESS_COMPLETE */,\n                    processId,\n                    result,\n                });\n            }\n            catch (error) {\n                // console.log(`[Host] Sending REMOTE_PROCESS_COMPLETE (error) processId: ${processId}`);\n                this.comms.castMessage({\n                    topic: \"remote_process_complete\" /* REMOTE_PROCESS_COMPLETE */,\n                    processId,\n                    error,\n                });\n            }\n        });\n    }\n    handleExit(message) {\n        if (!this.exitHandler) {\n            throw new Error('EXIT called, but no handler registered');\n        }\n        // if the host has requested a save, then don't call the exitHandler\n        if (this.saveRequested) {\n            return;\n        }\n        this.exitHandler(message.image);\n    }\n}\nexports.HostBus = HostBus;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst __1 = require(\"../\");\nclass IFrameHostBusComms {\n    constructor(port) {\n        this.port = port;\n        this.mailbox = new __1.Mailbox({\n            bufferSize: IFrameHostBusComms.MAILBOX_BUFFER_SIZE,\n            timeout: IFrameHostBusComms.MESSAGING_TIMEOUT,\n        });\n        this.envelopeMinter = new __1.Envelope.Minter();\n        this.messageHandler = new __1.EventHandler();\n        this.onPortMessage = (event) => {\n            // console.log('[Host] Receiving event =', event);\n            const message = event.data;\n            if (message.responseToId != null) {\n                this.mailbox.enqueueMessage(message);\n            }\n            this.messageHandler.emit(event);\n        };\n        this.port.onmessage = this.onPortMessage;\n    }\n    onMessage(handler) {\n        this.messageHandler.addEventListener((event) => __awaiter(this, void 0, void 0, function* () {\n            const message = event.data;\n            if (message.responseToId == null) {\n                const response = yield handler(message.content);\n                if (response) {\n                    this.respondTo(response, message.id);\n                }\n            }\n        }));\n    }\n    castMessage(msg) {\n        this.port.postMessage(this.envelopeMinter.mint(msg));\n    }\n    sendMessage(msg, timeout) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const envelope = this.envelopeMinter.mint(msg);\n            // console.log('[Host] Sending Envelope =', envelope);\n            this.port.postMessage(envelope);\n            const response = yield this.mailbox.receiveReply(envelope.id, timeout);\n            return response.content;\n        });\n    }\n    respondTo(message, responseToId) {\n        this.port.postMessage(this.envelopeMinter.mint(message, responseToId));\n    }\n}\nexports.IFrameHostBusComms = IFrameHostBusComms;\nIFrameHostBusComms.MAILBOX_BUFFER_SIZE = 5;\nIFrameHostBusComms.MESSAGING_TIMEOUT = 5000;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst iframe_host_comms_1 = require(\"./iframe_host_comms\");\nfunction connect(iframe) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return new Promise((resolve, reject) => {\n            try {\n                const listener = (event) => {\n                    const message = event.data;\n                    if (event.source !== iframe.contentWindow ||\n                        message.topic !== \"wake_up\" /* WAKE_UP */) {\n                        return;\n                    }\n                    // console.log('[Host] Received WAKE_UP');\n                    const [port] = event.ports;\n                    window.removeEventListener('message', listener);\n                    resolve(new iframe_host_comms_1.IFrameHostBusComms(port));\n                };\n                window.addEventListener('message', listener);\n            }\n            catch (e) {\n                reject(e);\n            }\n        });\n    });\n}\nexports.connect = connect;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst canva_api_client_1 = require(\"./canva_api_client\");\nexports.CanvaApiClient = canva_api_client_1.CanvaApiClient;\n// canva image\nvar canva_image_1 = require(\"./canva_image\");\nexports.CanvaImage = canva_image_1.CanvaImage;\n// control kit types\nvar control_kit_1 = require(\"./control_kit/control_kit\");\nexports.ControlName = control_kit_1.ControlName;\n// control kit components\nvar control_kit_2 = require(\"./control_kit/control_kit\");\nexports.ColorPicker = control_kit_2.ColorPicker;\nexports.Page = control_kit_2.Page;\nexports.Select = control_kit_2.Select;\nvar group_1 = require(\"./control_kit/group\");\nexports.Group = group_1.Group;\nvar slider_1 = require(\"./control_kit/slider\");\nexports.Slider = slider_1.Slider;\nvar button_1 = require(\"./control_kit/button\");\nexports.Button = button_1.Button;\nvar checkbox_1 = require(\"./control_kit/checkbox\");\nexports.Checkbox = checkbox_1.Checkbox;\nvar paragraph_1 = require(\"./control_kit/paragraph\");\nexports.Paragraph = paragraph_1.Paragraph;\nvar text_input_1 = require(\"./control_kit/text_input\");\nexports.TextInput = text_input_1.TextInput;\nvar radio_group_1 = require(\"./control_kit/radio-group\");\nexports.RadioGroup = radio_group_1.RadioGroup;\nvar preview_overlay_1 = require(\"./control_kit/preview_overlay\");\nexports.PreviewOverlay = preview_overlay_1.PreviewOverlay;\nvar thumbnail_list_1 = require(\"./control_kit/thumbnail_list\");\nexports.ThumbnailId = thumbnail_list_1.ThumbnailId;\nexports.ThumbnailList = thumbnail_list_1.ThumbnailList;\n// errors\nvar errors_1 = require(\"./errors\");\nexports.UnreachableError = errors_1.UnreachableError;\nexports.UnimplementedError = errors_1.UnimplementedError;\nvar canva_api_1 = require(\"./canva_api\");\nexports.Message = canva_api_1.Message;\nvar mailbox_1 = require(\"./mailbox\");\nexports.Envelope = mailbox_1.Envelope;\nexports.Mailbox = mailbox_1.Mailbox;\nvar event_handler_1 = require(\"./event_handler\");\nexports.EventHandler = event_handler_1.EventHandler;\n// TODO split out into `@canva/editing-extensions-host`\nvar host_bus_1 = require(\"./host/host_bus\");\nexports.HostBus = host_bus_1.HostBus;\nvar iframe_connection_1 = require(\"./host/iframe_connection\");\nexports.connect = iframe_connection_1.connect;\nconst canva_image_2 = require(\"./canva_image\");\nconst preview_overlay_2 = require(\"./control_kit/preview_overlay\");\nconst thumbnail_list_2 = require(\"./control_kit/thumbnail_list\");\nconst control_kit_3 = require(\"./control_kit/control_kit\");\nif (window.__exposeCanvaOnWindow) {\n    window.canva = {\n        CanvaApiClient: canva_api_client_1.CanvaApiClient,\n        CanvaImage: canva_image_2.CanvaImage,\n        Button: control_kit_3.Button,\n        Checkbox: control_kit_3.Checkbox,\n        ColorPicker: control_kit_3.ColorPicker,\n        Group: control_kit_3.Group,\n        Page: control_kit_3.Page,\n        Paragraph: control_kit_3.Paragraph,\n        PreviewOverlay: preview_overlay_2.PreviewOverlay,\n        Select: control_kit_3.Select,\n        Slider: control_kit_3.Slider,\n        TextInput: control_kit_3.TextInput,\n        ThumbnailList: thumbnail_list_2.ThumbnailList,\n    };\n}\n","import { Paragraph, Group, RadioGroup, Slider, ColorPicker, TextInput } from '@canva/editing-extensions-api';\n\nexport const renderSettings = state => {\n    const { text, watermarkPostion, size, color, opacity } = state;\n    return [\n        Paragraph.create({\n            id: 'paragraph',\n            text: 'Provide copyright watermark on your protected images.',\n        }),\n        Group.create({\n            id: 'settingsGroup',\n            label: 'Settings',\n            children: [\n                Group.create({\n                    id: 'postionRadioGroup',\n                    label: 'Postion',\n                    children: [\n                        RadioGroup.create({\n                            id: 'postionControl',\n                            value: watermarkPostion,\n                            buttons: [\n                                {\n                                    label: 'Bottom Right',\n                                    value: 'lowerRight',\n                                },\n                                {\n                                    label: 'Bottom Left',\n                                    value: 'lowerLeft',\n                                },\n                                {\n                                    label: 'Center',\n                                    value: 'center',\n                                },\n                            ],\n                        }),\n                    ],\n                }),\n                TextInput.create({\n                    id: 'textControl',\n                    inputType: 'text',\n                    value: text,\n                    label: 'Text',\n                }),\n\n                TextInput.create({\n                    id: 'sizeControl',\n                    inputType: 'text',\n                    value: size,\n                    label: 'Text',\n                }),\n\n                Slider.create({\n                    id: 'opacityControl',\n                    label: 'Opacity',\n                    value: opacity,\n                    min: 0.0,\n                    max: 1.0,\n                    step: 0.1,\n                }),\n                ColorPicker.create({\n                    id: 'colorControl',\n                    label: 'Watermark Color',\n                    color,\n                }),\n            ],\n        }),\n    ];\n};\n","export function controlsEventsHandler(event, state) {\n    const {\n        controlId: id,\n        message: { value },\n    } = event;\n\n    if (id === 'postionControl') {\n        return { ...state, watermarkPostion: value };\n    }\n\n    if (id === 'opacityControl') {\n        return { ...state, opacity: value };\n    }\n\n    if (id === 'sizeControl') {\n        return { ...state, size: value };\n    }\n\n    if (id === 'colorControl') {\n        return { ...state, color: value };\n    }\n\n    if (id === 'textControl') {\n        return { ...state, text: value };\n    }\n\n    return state;\n}\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"watermark\"] = factory();\n\telse\n\t\troot[\"watermark\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(1);\n\tmodule.exports = __webpack_require__(2).default;\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t// required to safely use babel/register within a browserify codebase\n\n\t\"use strict\";\n\n\texports.__esModule = true;\n\n\texports[\"default\"] = function () {};\n\n\tmodule.exports = exports[\"default\"];\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = watermark;\n\n\tvar _image = __webpack_require__(3);\n\n\tvar _canvas = __webpack_require__(5);\n\n\tvar _blob = __webpack_require__(6);\n\n\tvar _style = __webpack_require__(7);\n\n\tvar style = _interopRequireWildcard(_style);\n\n\tvar _object = __webpack_require__(10);\n\n\tvar _pool = __webpack_require__(11);\n\n\tvar _pool2 = _interopRequireDefault(_pool);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n\t/**\n\t * A configuration type for the watermark function\n\t *\n\t * @typedef {Object} Options\n\t * @property {Function} init - an initialization function that is given Image objects before loading (only applies if resources is a collection of urls)\n\t * @property {Number} poolSize - number of canvas elements available for drawing,\n\t * @property {CanvasPool} pool - the pool used. If provided, poolSize will be ignored\n\t */\n\n\t/**\n\t * @constant\n\t * @type {Options}\n\t */\n\tvar defaults = {\n\t  init: function init() {}\n\t};\n\n\t/**\n\t * Merge the given options with the defaults\n\t *\n\t * @param {Options} options\n\t * @return {Options}\n\t */\n\tfunction mergeOptions(options) {\n\t  return (0, _object.extend)((0, _object.clone)(defaults), options);\n\t}\n\n\t/**\n\t * Release canvases from a draw result for reuse. Returns\n\t * the dataURL from the result's canvas\n\t *\n\t * @param {DrawResult} result\n\t * @param {CanvasPool} pool\n\t * @return  {String}\n\t */\n\tfunction release(result, pool) {\n\t  var canvas = result.canvas;\n\t  var sources = result.sources;\n\n\t  var dataURL = (0, _canvas.dataUrl)(canvas);\n\t  sources.forEach(pool.release);\n\t  return dataURL;\n\t}\n\n\t/**\n\t * Return a watermark object\n\t *\n\t *\n\t * @param {Array} resources - a collection of urls, File objects, or Image objects\n\t * @param {Options} options - a configuration object for watermark\n\t * @param {Promise} promise - optional\n\t * @return {Object}\n\t */\n\tfunction watermark(resources) {\n\t  var options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\t  var promise = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];\n\n\t  var opts = mergeOptions(options);\n\t  promise || (promise = (0, _image.load)(resources, opts.init));\n\n\t  return {\n\t    /**\n\t     * Convert the watermarked image into a dataUrl. The draw\n\t     * function is given all images as canvas elements in order\n\t     *\n\t     * @param {Function} draw\n\t     * @return {Object}\n\t     */\n\n\t    dataUrl: function dataUrl(draw) {\n\t      var promise = this.then(function (images) {\n\t        return (0, _image.mapToCanvas)(images, _pool2.default);\n\t      }).then(function (canvases) {\n\t        return style.result(draw, canvases);\n\t      }).then(function (result) {\n\t        return release(result, _pool2.default);\n\t      });\n\n\t      return watermark(resources, opts, promise);\n\t    },\n\n\t    /**\n\t     * Load additional resources\n\t     *\n\t     * @param {Array} resources - a collection of urls, File objects, or Image objects\n\t     * @param {Function} init - an initialization function that is given Image objects before loading (only applies if resources is a collection of urls)\n\t     * @return {Object}\n\t     */\n\t    load: function load(resources, init) {\n\t      var promise = this.then(function (resource) {\n\t        return (0, _image.load)([resource].concat(resources), init);\n\t      });\n\n\t      return watermark(resources, opts, promise);\n\t    },\n\n\t    /**\n\t     * Render the current state of the watermarked image. Useful for performing\n\t     * actions after the watermark has been applied\n\t     *\n\t     * @return {Object}\n\t     */\n\t    render: function render() {\n\t      var promise = this.then(function (resource) {\n\t        return (0, _image.load)([resource]);\n\t      });\n\n\t      return watermark(resources, opts, promise);\n\t    },\n\n\t    /**\n\t     * Convert the watermark into a blob\n\t     *\n\t     * @param {Function} draw\n\t     * @return {Object}\n\t     */\n\t    blob: function blob(draw) {\n\t      var promise = this.dataUrl(draw).then(_blob.blob);\n\n\t      return watermark(resources, opts, promise);\n\t    },\n\n\t    /**\n\t     * Convert the watermark into an image using the given draw function\n\t     *\n\t     * @param {Function} draw\n\t     * @return {Object}\n\t     */\n\t    image: function image(draw) {\n\t      var promise = this.dataUrl(draw).then(_image.createImage);\n\n\t      return watermark(resources, opts, promise);\n\t    },\n\n\t    /**\n\t     * Delegate to the watermark promise\n\t     *\n\t     * @return {Promise}\n\t     */\n\t    then: function then() {\n\t      for (var _len = arguments.length, funcs = Array(_len), _key = 0; _key < _len; _key++) {\n\t        funcs[_key] = arguments[_key];\n\t      }\n\n\t      return promise.then.apply(promise, funcs);\n\t    }\n\t  };\n\t};\n\n\t/**\n\t * Style functions\n\t */\n\twatermark.image = style.image;\n\twatermark.text = style.text;\n\n\t/**\n\t * Clean up all canvas references\n\t */\n\twatermark.destroy = function () {\n\t  return _pool2.default.clear();\n\t};\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.getLoader = getLoader;\n\texports.load = load;\n\texports.loadUrl = loadUrl;\n\texports.loadFile = loadFile;\n\texports.createImage = createImage;\n\texports.imageToCanvas = imageToCanvas;\n\texports.mapToCanvas = mapToCanvas;\n\n\tvar _functions = __webpack_require__(4);\n\n\tfunction _typeof(obj) { return obj && typeof Symbol !== \"undefined\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; }\n\n\t/**\n\t * Set the src of an image object and call the resolve function\n\t * once it has loaded\n\t *\n\t * @param {Image} img\n\t * @param {String} src\n\t * @param {Function} resolve\n\t */\n\tfunction setAndResolve(img, src, resolve) {\n\t  img.onload = function () {\n\t    return resolve(img);\n\t  };\n\t  img.src = src;\n\t}\n\n\t/**\n\t * Given a resource, return an appropriate loading function for it's type\n\t *\n\t * @param {String|File|Image} resource\n\t * @return {Function}\n\t */\n\tfunction getLoader(resource) {\n\t  var type = typeof resource === 'undefined' ? 'undefined' : _typeof(resource);\n\n\t  if (type === 'string') {\n\t    return loadUrl;\n\t  }\n\n\t  if (resource instanceof Image) {\n\t    return _functions.identity;\n\t  }\n\n\t  return loadFile;\n\t}\n\n\t/**\n\t * Used for loading image resources asynchronously and maintaining\n\t * the supplied order of arguments\n\t *\n\t * @param {Array} resources - a mixed array of urls, File objects, or Image objects\n\t * @param {Function} init - called at the beginning of resource initialization\n\t * @return {Promise}\n\t */\n\tfunction load(resources, init) {\n\t  var promises = [];\n\t  for (var i = 0; i < resources.length; i++) {\n\t    var resource = resources[i];\n\t    var loader = getLoader(resource);\n\t    var promise = loader(resource, init);\n\t    promises.push(promise);\n\t  }\n\t  return Promise.all(promises);\n\t}\n\n\t/**\n\t * Load an image by its url\n\t *\n\t * @param {String} url\n\t * @param {Function} init - an optional image initializer\n\t * @return {Promise}\n\t */\n\tfunction loadUrl(url, init) {\n\t  var img = new Image();\n\t  typeof init === 'function' && init(img);\n\t  return new Promise(function (resolve) {\n\t    img.onload = function () {\n\t      return resolve(img);\n\t    };\n\t    img.src = url;\n\t  });\n\t}\n\n\t/**\n\t * Return a collection of images from an\n\t * array of File objects\n\t *\n\t * @param {File} file\n\t * @return {Promise}\n\t */\n\tfunction loadFile(file) {\n\t  var reader = new FileReader();\n\t  return new Promise(function (resolve) {\n\t    var img = new Image();\n\t    reader.onloadend = function () {\n\t      return setAndResolve(img, reader.result, resolve);\n\t    };\n\t    reader.readAsDataURL(file);\n\t  });\n\t}\n\n\t/**\n\t * Create a new image, optionally configuring it's onload behavior\n\t *\n\t * @param {String} url\n\t * @param {Function} onload\n\t * @return {Image}\n\t */\n\tfunction createImage(url, onload) {\n\t  var img = new Image();\n\t  if (typeof onload === 'function') {\n\t    img.onload = onload;\n\t  }\n\t  img.src = url;\n\t  return img;\n\t}\n\n\t/**\n\t * Draw an image to a canvas element\n\t *\n\t * @param {Image} img\n\t * @param {HTMLCanvasElement} canvas\n\t * @return {HTMLCanvasElement}\n\t */\n\tfunction drawImage(img, canvas) {\n\t  var ctx = canvas.getContext('2d');\n\n\t  canvas.width = img.width;\n\t  canvas.height = img.height;\n\t  ctx.drawImage(img, 0, 0);\n\t  return canvas;\n\t}\n\n\t/**\n\t * Convert an Image object to a canvas\n\t *\n\t * @param {Image} img\n\t * @param {CanvasPool} pool\n\t * @return {HTMLCanvasElement}\n\t */\n\tfunction imageToCanvas(img, pool) {\n\t  var canvas = pool.pop();\n\t  return drawImage(img, canvas);\n\t}\n\n\t/**\n\t * Convert an array of image objects\n\t * to canvas elements\n\t *\n\t * @param {Array} images\n\t * @param {CanvasPool} pool\n\t * @return {HTMLCanvasElement[]}\n\t */\n\tfunction mapToCanvas(images, pool) {\n\t  return images.map(function (img) {\n\t    return imageToCanvas(img, pool);\n\t  });\n\t}\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.sequence = sequence;\n\texports.identity = identity;\n\t/**\n\t * Return a function that executes a sequence of functions from left to right,\n\t * passing the result of a previous operation to the next\n\t *\n\t * @param {...funcs}\n\t * @return {Function}\n\t */\n\tfunction sequence() {\n\t  for (var _len = arguments.length, funcs = Array(_len), _key = 0; _key < _len; _key++) {\n\t    funcs[_key] = arguments[_key];\n\t  }\n\n\t  return function (value) {\n\t    return funcs.reduce(function (val, fn) {\n\t      return fn.call(null, val);\n\t    }, value);\n\t  };\n\t}\n\n\t/**\n\t * Return the argument passed to it\n\t *\n\t * @param {Mixed} x\n\t * @return {Mixed}\n\t */\n\tfunction identity(x) {\n\t  return x;\n\t}\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.dataUrl = dataUrl;\n\t/**\n\t * Get the data url of a canvas\n\t *\n\t * @param {HTMLCanvasElement}\n\t * @return {String}\n\t */\n\tfunction dataUrl(canvas) {\n\t  return canvas.toDataURL();\n\t}\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.blob = undefined;\n\texports.split = split;\n\texports.decode = decode;\n\texports.uint8 = uint8;\n\n\tvar _functions = __webpack_require__(4);\n\n\tvar url = /^data:([^;]+);base64,(.*)$/;\n\n\t/**\n\t * Split a data url into a content type and raw data\n\t *\n\t * @param {String} dataUrl\n\t * @return {Array}\n\t */\n\tfunction split(dataUrl) {\n\t  return url.exec(dataUrl).slice(1);\n\t}\n\n\t/**\n\t * Decode a base64 string\n\t *\n\t * @param {String} base64\n\t * @return {String}\n\t */\n\tfunction decode(base64) {\n\t  return window.atob(base64);\n\t}\n\n\t/**\n\t * Return a string of raw data as a Uint8Array\n\t *\n\t * @param {String} data\n\t * @return {UInt8Array}\n\t */\n\tfunction uint8(data) {\n\t  var length = data.length;\n\t  var uints = new Uint8Array(length);\n\n\t  for (var i = 0; i < length; i++) {\n\t    uints[i] = data.charCodeAt(i);\n\t  }\n\n\t  return uints;\n\t}\n\n\t/**\n\t * Turns a data url into a blob object\n\t *\n\t * @param {String} dataUrl\n\t * @return {Blob}\n\t */\n\tvar blob = exports.blob = (0, _functions.sequence)(split, function (parts) {\n\t  return [decode(parts[1]), parts[0]];\n\t}, function (blob) {\n\t  return new Blob([uint8(blob[0])], { type: blob[1] });\n\t});\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.text = exports.image = undefined;\n\texports.result = result;\n\n\tvar _image = __webpack_require__(8);\n\n\tvar img = _interopRequireWildcard(_image);\n\n\tvar _text = __webpack_require__(9);\n\n\tvar txt = _interopRequireWildcard(_text);\n\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n\t/**\n\t * @typedef {Object} DrawResult\n\t * @property {HTMLCanvasElement} canvas - the end result of a draw\n\t * @property {HTMLCanvasElement[]} sources - the sources used in the draw\n\t */\n\n\tvar image = exports.image = img;\n\tvar text = exports.text = txt;\n\n\t/**\n\t * Create a DrawResult by apply a list of canvas elements to a draw function\n\t *\n\t * @param {Function} draw - the draw function used to create a DrawResult\n\t * @param {HTMLCanvasElement} sources - the canvases used by the draw function\n\t * @return {DrawResult}\n\t */\n\tfunction result(draw, sources) {\n\t  var canvas = draw.apply(null, sources);\n\t  return {\n\t    canvas: canvas,\n\t    sources: sources\n\t  };\n\t}\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.atPos = atPos;\n\texports.lowerRight = lowerRight;\n\texports.upperRight = upperRight;\n\texports.lowerLeft = lowerLeft;\n\texports.upperLeft = upperLeft;\n\texports.center = center;\n\t/**\n\t * Return a function for positioning a watermark on a target canvas\n\t *\n\t * @param {Function} xFn - a function to determine an x value\n\t * @param {Function} yFn - a function to determine a y value\n\t * @param {Number} alpha\n\t * @return {Function}\n\t */\n\tfunction atPos(xFn, yFn, alpha) {\n\t  alpha || (alpha = 1.0);\n\t  return function (target, watermark) {\n\t    var context = target.getContext('2d');\n\t    context.save();\n\n\t    context.globalAlpha = alpha;\n\t    context.drawImage(watermark, xFn(target, watermark), yFn(target, watermark));\n\n\t    context.restore();\n\t    return target;\n\t  };\n\t}\n\n\t/**\n\t * Place the watermark in the lower right corner of the target\n\t * image\n\t *\n\t * @param {Number} alpha\n\t * @return {Function}\n\t */\n\tfunction lowerRight(alpha) {\n\t  return atPos(function (target, mark) {\n\t    return target.width - (mark.width + 10);\n\t  }, function (target, mark) {\n\t    return target.height - (mark.height + 10);\n\t  }, alpha);\n\t}\n\n\t/**\n\t * Place the watermark in the upper right corner of the target\n\t * image\n\t *\n\t * @param {Number} alpha\n\t * @return {Function}\n\t */\n\tfunction upperRight(alpha) {\n\t  return atPos(function (target, mark) {\n\t    return target.width - (mark.width + 10);\n\t  }, function (target, mark) {\n\t    return 10;\n\t  }, alpha);\n\t}\n\n\t/**\n\t * Place the watermark in the lower left corner of the target\n\t * image\n\t *\n\t * @param {Number} alpha\n\t * @return {Function}\n\t */\n\tfunction lowerLeft(alpha) {\n\t  return atPos(function (target, mark) {\n\t    return 10;\n\t  }, function (target, mark) {\n\t    return target.height - (mark.height + 10);\n\t  }, alpha);\n\t}\n\n\t/**\n\t * Place the watermark in the upper left corner of the target\n\t * image\n\t *\n\t * @param {Number} alpha\n\t * @return {Function}\n\t */\n\tfunction upperLeft(alpha) {\n\t  return atPos(function (target, mark) {\n\t    return 10;\n\t  }, function (target, mark) {\n\t    return 10;\n\t  }, alpha);\n\t}\n\n\t/**\n\t * Place the watermark in the center of the target\n\t * image\n\t *\n\t * @param {Number} alpha\n\t * @return {Function}\n\t */\n\tfunction center(alpha) {\n\t  return atPos(function (target, mark) {\n\t    return (target.width - mark.width) / 2;\n\t  }, function (target, mark) {\n\t    return (target.height - mark.height) / 2;\n\t  }, alpha);\n\t}\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.atPos = atPos;\n\texports.lowerRight = lowerRight;\n\texports.lowerLeft = lowerLeft;\n\texports.upperRight = upperRight;\n\texports.upperLeft = upperLeft;\n\texports.center = center;\n\t/**\n\t * Return a function for positioning a watermark on a target canvas\n\t *\n\t * @param {Function} xFn - a function to determine an x value\n\t * @param {Function} yFn - a function to determine a y value\n\t * @param {String} text - the text to write\n\t * @param {String} font - same as the CSS font property\n\t * @param {String} fillStyle\n\t * @param {Number} alpha\n\t * @return {Function}\n\t */\n\tfunction atPos(xFn, yFn, text, font, fillStyle, alpha) {\n\t  alpha || (alpha = 1.0);\n\t  return function (target) {\n\t    var context = target.getContext('2d');\n\t    context.save();\n\n\t    context.globalAlpha = alpha;\n\t    context.fillStyle = fillStyle;\n\t    context.font = font;\n\t    var metrics = context.measureText(text);\n\t    context.fillText(text, xFn(target, metrics, context), yFn(target, metrics, context));\n\n\t    context.restore();\n\t    return target;\n\t  };\n\t}\n\n\t/**\n\t * Write text to the lower right corner of the target canvas\n\t *\n\t * @param {String} text - the text to write\n\t * @param {String} font - same as the CSS font property\n\t * @param {String} fillStyle\n\t * @param {Number} alpha - control text transparency\n\t * @param {Number} y - height in text metrics is not very well supported. This is a manual value\n\t * @return {Function}\n\t */\n\tfunction lowerRight(text, font, fillStyle, alpha, y) {\n\t  return atPos(function (target, metrics) {\n\t    return target.width - (metrics.width + 10);\n\t  }, function (target) {\n\t    return y || target.height - 10;\n\t  }, text, font, fillStyle, alpha);\n\t}\n\n\t/**\n\t * Write text to the lower left corner of the target canvas\n\t *\n\t * @param {String} text - the text to write\n\t * @param {String} font - same as the CSS font property\n\t * @param {String} fillStyle\n\t * @param {Number} alpha - control text transparency\n\t * @param {Number} y - height in text metrics is not very well supported. This is a manual value\n\t * @return {Function}\n\t */\n\tfunction lowerLeft(text, font, fillStyle, alpha, y) {\n\t  return atPos(function () {\n\t    return 10;\n\t  }, function (target) {\n\t    return y || target.height - 10;\n\t  }, text, font, fillStyle, alpha);\n\t}\n\n\t/**\n\t * Write text to the upper right corner of the target canvas\n\t *\n\t * @param {String} text - the text to write\n\t * @param {String} font - same as the CSS font property\n\t * @param {String} fillStyle\n\t * @param {Number} alpha - control text transparency\n\t * @param {Number} y - height in text metrics is not very well supported. This is a manual value\n\t * @return {Function}\n\t */\n\tfunction upperRight(text, font, fillStyle, alpha, y) {\n\t  return atPos(function (target, metrics) {\n\t    return target.width - (metrics.width + 10);\n\t  }, function () {\n\t    return y || 20;\n\t  }, text, font, fillStyle, alpha);\n\t}\n\n\t/**\n\t * Write text to the upper left corner of the target canvas\n\t *\n\t * @param {String} text - the text to write\n\t * @param {String} font - same as the CSS font property\n\t * @param {String} fillStyle\n\t * @param {Number} alpha - control text transparency\n\t * @param {Number} y - height in text metrics is not very well supported. This is a manual value\n\t * @return {Function}\n\t */\n\tfunction upperLeft(text, font, fillStyle, alpha, y) {\n\t  return atPos(function () {\n\t    return 10;\n\t  }, function () {\n\t    return y || 20;\n\t  }, text, font, fillStyle, alpha);\n\t}\n\n\t/**\n\t * Write text to the center of the target canvas\n\t *\n\t * @param {String} text - the text to write\n\t * @param {String} font - same as the CSS font property\n\t * @param {String} fillStyle\n\t * @param {Number} alpha - control text transparency\n\t * @param {Number} y - height in text metrics is not very well supported. This is a manual value\n\t * @return {Function}\n\t */\n\tfunction center(text, font, fillStyle, alpha, y) {\n\t  return atPos(function (target, metrics, ctx) {\n\t    ctx.textAlign = 'center';return target.width / 2;\n\t  }, function (target, metrics, ctx) {\n\t    ctx.textBaseline = 'middle';return target.height / 2;\n\t  }, text, font, fillStyle, alpha);\n\t}\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.extend = extend;\n\texports.clone = clone;\n\t/**\n\t * Extend one object with the properties of another\n\t *\n\t * @param {Object} first\n\t * @param {Object} second\n\t * @return {Object}\n\t */\n\tfunction extend(first, second) {\n\t  var secondKeys = Object.keys(second);\n\t  secondKeys.forEach(function (key) {\n\t    return first[key] = second[key];\n\t  });\n\t  return first;\n\t}\n\n\t/**\n\t * Create a shallow copy of the object\n\t *\n\t * @param {Object} obj\n\t * @return {Object}\n\t */\n\tfunction clone(obj) {\n\t  return extend({}, obj);\n\t}\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.CanvasPool = CanvasPool;\n\t/**\n\t * An immutable canvas pool allowing more efficient use of canvas resources\n\t *\n\t * @typedef {Object} CanvasPool\n\t * @property {Function} pop - return a promise that will evaluate to a canvas\n\t * @property {Number} length - the number of available canvas elements\n\t * @property {HTMLCanvasElement[]} elements - the canvas elements used by the pool\n\t * @property {Function} clear - empty the pool of canvas elements\n\t * @property {Function} release - free a pool up for release and return the data url\n\t */\n\n\t/**\n\t * Create a CanvasPool with the given size\n\t *\n\t * @param {Number} size\n\t * @param {HTMLCanvasElement[]} elements\n\t * @param {EventEmitter} eventEmitter\n\t * @return {CanvasPool}\n\t */\n\tfunction CanvasPool() {\n\t  var canvases = [];\n\n\t  return {\n\t    /**\n\t     * Get the next available canvas from the pool\n\t     *\n\t     * @return {HTMLCanvasElement}\n\t     */\n\n\t    pop: function pop() {\n\t      if (this.length === 0) {\n\t        canvases.push(document.createElement('canvas'));\n\t      }\n\n\t      return canvases.pop();\n\t    },\n\n\t    /**\n\t     * Return the number of available canvas elements in the pool\n\t     *\n\t     * @return {Number}\n\t     */\n\t    get length() {\n\t      return canvases.length;\n\t    },\n\n\t    /**\n\t     * Return a canvas to the pool. This function will clear the canvas for reuse\n\t     *\n\t     * @param {HTMLCanvasElement} canvas\n\t     * @return {String}\n\t     */\n\t    release: function release(canvas) {\n\t      var context = canvas.getContext('2d');\n\t      context.clearRect(0, 0, canvas.width, canvas.height);\n\t      canvases.push(canvas);\n\t    },\n\n\t    /**\n\t     * Empty the pool, destroying any references to canvas objects\n\t     */\n\t    clear: function clear() {\n\t      canvases.splice(0, canvases.length);\n\t    },\n\n\t    /**\n\t     * Return the collection of canvases in the pool\n\t     *\n\t     * @return {HTMLCanvasElement[]}\n\t     */\n\t    get elements() {\n\t      return canvases;\n\t    }\n\t  };\n\t}\n\n\tvar shared = CanvasPool();\n\texports.default = shared;\n\n/***/ }\n/******/ ])\n});\n;","import { CanvaApiClient, Page, CanvaImage } from '@canva/editing-extensions-api';\nimport { renderSettings } from './controls';\nimport { controlsEventsHandler } from './events';\nimport watermark from 'watermarkjs';\n\nlet state = {\n    watermarkPostion: 'lowerRight',\n    opacity: 0.7,\n    color: \"#ffffff\",\n    size: 20,\n    text: '© Canva Apps'\n};\nlet prevState = state;\nlet context;\nlet canvas;\n\nCanvaApiClient.initialize(async canva => {\n        \n    function renderControls() {\n        canva.updateControlPanel(\n            Page.create({\n                controls: [...renderSettings(state)],\n            }),\n        );\n    };\n\n    async function render(state){\n        console.log(\"IN RENDER: STATE: \", state);\n\n        renderControls(state);\n        const {opts, watermarkPostion, opacity, color, size, text} = state;\n        console.log({watermarkPostion});\n        let image;\n        if(!state.image){\n            image =  await CanvaImage.toImageElement(opts.image);\n        }\n       \n    \n        watermark([image])\n            .image(watermark.text[watermarkPostion](text, `${size}px Josefin Slab`, color, opacity))\n            .then(function(image) {\n                context.drawImage(image, 0, 0, canvas.width, canvas.height);\n                state = {...state, image};\n            });\n    }\n\n    setInterval(() => {\n        if (prevState !== state) {\n            console.info(\"State: \", {state, prevState});\n            render(state);\n            prevState = state;\n        }\n    }, 200);\n\n    \n    canva.onReady(async opts => {\n        state = {...state, opts};\n        const {image} =  opts;\n        canvas = document.createElement('canvas');\n    \n        canvas.width = image.width;\n        canvas.height = image.height;\n        canvas.style.width = '100%';\n        canvas.style.height = '100%';\n    \n        document.body.appendChild(canvas);\n        context = canvas.getContext('2d');\n        render(state);\n        canva.onControlsEvent(async event => {\n            console.log({event, state});\n            state = controlsEventsHandler(event, state);\n        });\n    });\n\n    const {image} = state;\n    canva.onSaveRequest(async () => image);\n});\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}