!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["@canva/editing-extensions-api"]=t():e["@canva/editing-extensions-api"]=t()}(window,(function(){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(15);t.CanvaApiClient=r.CanvaApiClient;var n=s(5);t.CanvaImage=n.CanvaImage;var o=s(1);t.ControlName=o.ControlName;var i=s(1);t.ColorPicker=i.ColorPicker,t.Page=i.Page,t.Select=i.Select;var a=s(8);t.Group=a.Group;var c=s(6);t.Slider=c.Slider;var l=s(7);t.Button=l.Button;var u=s(11);t.Checkbox=u.Checkbox;var d=s(12);t.Paragraph=d.Paragraph;var h=s(10);t.TextInput=h.TextInput;var p=s(9);t.RadioGroup=p.RadioGroup;var m=s(13);t.PreviewOverlay=m.PreviewOverlay;var v=s(14);t.ThumbnailId=v.ThumbnailId,t.ThumbnailList=v.ThumbnailList;var f=s(2);t.UnreachableError=f.UnreachableError,t.UnimplementedError=f.UnimplementedError;var g=s(19);t.Message=g.Message;var _=s(4);t.Envelope=_.Envelope,t.Mailbox=_.Mailbox;var b=s(3);t.EventHandler=b.EventHandler;var E=s(20);t.HostBus=E.HostBus;var w=s(21);t.connect=w.connect;const y=s(5),M=s(13),P=s(14),R=s(1);window.__exposeCanvaOnWindow&&(window.canva={CanvaApiClient:r.CanvaApiClient,CanvaImage:y.CanvaImage,Button:R.Button,Checkbox:R.Checkbox,ColorPicker:R.ColorPicker,Group:R.Group,Page:R.Page,Paragraph:R.Paragraph,PreviewOverlay:M.PreviewOverlay,Select:R.Select,Slider:R.Slider,TextInput:R.TextInput,ThumbnailList:P.ThumbnailList})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(17);t.ControlName=r.ControlName;var n=s(6);t.Slider=n.Slider;var o=s(7);t.Button=o.Button;var i=s(8);t.Group=i.Group;var a=s(18);t.Select=a.Select;var c=s(9);t.RadioGroup=c.RadioGroup;var l=s(10);t.TextInput=l.TextInput;var u=s(11);t.Checkbox=u.Checkbox;var d=s(12);t.Paragraph=d.Paragraph,function(e){e.create=e=>Object.assign({type:"color_picker"},e)}(t.ColorPicker||(t.ColorPicker={})),function(e){e.create=({subpage:e,title:t,actionLabel:s,controls:r})=>e?{type:"control_panel",id:"control_panel",subpage:!0,title:t,actionLabel:s,controls:r}:{type:"control_panel",id:"control_panel",subpage:!1,controls:r}}(t.Page||(t.Page={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UnreachableError=class{constructor(e,t){console.error(`UnreachableError (${e})`,t)}};t.UnimplementedError=class extends Error{}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EventHandler=class{constructor(){this.handlers=new Set}addEventListener(e){this.handlers.add(e)}removeEventListener(e){this.handlers.delete(e)}emit(...e){return this.handlers.forEach(t=>t(...e))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Minter=class{constructor(){this.nextEnvelopeId=0}mint(e,t){return{id:this.nextEnvelopeId++,content:e,responseToId:t}}}}(t.Envelope||(t.Envelope={}));t.Mailbox=class{constructor(e){this.opts=e,this.handlers=new Set,this.messages=[]}receiveReply(e,t){for(const[t,s]of this.messages.entries())if(s.responseToId===e)return this.messages.splice(t,1),Promise.resolve(s);const s=new Promise(t=>{const s=r=>r.responseToId===e&&(this.handlers.delete(s),t(r),!0);this.handlers.add(s)}),r=new Promise((e,s)=>{setTimeout(()=>{s(new Error("Mailbox timed out waiting for reply"))},t||this.opts.timeout)});return Promise.race([s,r])}enqueueMessage(e){for(const t of this.handlers.values())if(t(e))return;this.messages.push(e),this.messages.length>this.opts.bufferSize&&this.messages.shift()}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=navigator&&navigator.userAgent.match(/chrome/i)&&navigator.userAgent.match(/safari/i),o=e=>n?i(e):a(e),i=e=>new Promise((t,s)=>{const r=new FileReader;r.onload=function(){if(r&&r.result instanceof ArrayBuffer){const s=a(new Blob([new Uint8Array(r.result)],{type:e.type}));t(s)}else s("unknown error")},r.onerror=e=>s(e),r.readAsArrayBuffer(e)}),a=e=>new Promise((t,s)=>{const r=new Image;r.crossOrigin="anonymous";const n=URL.createObjectURL(e);r.onload=()=>{t(r),URL.revokeObjectURL(n)},r.onerror=()=>{console.error("blobToImage","failed"),s("Could not load image")},r.src=n});!function(e){e.fromCanvas=(e,t,s)=>r(this,void 0,void 0,(function*(){const n=yield((e,t,s)=>r(void 0,void 0,void 0,(function*(){if("function"==typeof e.toBlob){return yield new Promise((r,n)=>{try{e.toBlob(e=>e instanceof Blob?r(e):n(e),t,s)}catch(e){n(e)}})}const r=e.toDataURL(t,s).split(",")[1],n=atob(r),o=n.length,i=new Uint8Array(o);for(let e=0;e<o;e++)i[e]=n.charCodeAt(e);return new Blob([i],{type:t||"image/png"})})))(t,e,s);if(n instanceof Blob){const{width:s,height:r}=t;return{blob:n,imageType:e,width:s,height:r}}throw new Error("Could not create Blob from Canvas")})),e.fromDataUrl=(e,t)=>r(this,void 0,void 0,(function*(){const s=function(e){const t=atob(e.split(",")[1]),s=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),n=new Uint8Array(r);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return new Blob([r],{type:s})}(t),{width:r,height:n}=yield o(s);return{blob:s,imageType:e,width:r,height:n}})),e.fromUrl=e=>r(this,void 0,void 0,(function*(){const t=yield fetch(e),s=yield t.blob(),r=s.type,{width:n,height:i}=yield o(s);return{blob:s,imageType:r,width:n,height:i}})),e.toImageElement=e=>o(e.blob),e.toDataUrl=e=>new Promise((t,s)=>{const r=new FileReader;r.onload=e=>{r.result&&"string"==typeof r.result?t(r.result):s("Unexpected FileReader result")},r.onerror=()=>{s("Error loading blob")},r.readAsDataURL(e.blob)}),e.getSize=e=>({width:e.width,height:e.height})}(t.CanvaImage||(t.CanvaImage={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"slider"},e)}(t.Slider||(t.Slider={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"button"},e)}(t.Button||(t.Button={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"group"},e)}(t.Group||(t.Group={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"radio_group"},e)}(t.RadioGroup||(t.RadioGroup={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"text_input"},e)}(t.TextInput||(t.TextInput={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"checkbox"},e)}(t.Checkbox||(t.Checkbox={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"paragraph"},e)}(t.Paragraph||(t.Paragraph={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t;e.type="PREVIEW_OVERLAY",function(e){e.SUCCESS="success",e.ERROR="error",e.INFO="info"}(t=e.NotificationType||(e.NotificationType={})),e.create=t=>Object.assign({type:e.type},t)}(t.PreviewOverlay||(t.PreviewOverlay={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>e}(t.ThumbnailId||(t.ThumbnailId={})),function(e){e.create=e=>Object.assign({type:"thumbnail_list"},e)}(t.ThumbnailList||(t.ThumbnailList={}))},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__rest||function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s};Object.defineProperty(t,"__esModule",{value:!0});const o=s(2),i=s(16);class a{constructor(e){this.comms=e,this.remoteProcessCounter=0,this.onReceiveMessage=e=>r(this,void 0,void 0,(function*(){if(this.exitingWithImage)return"save_request"===e.topic?Promise.resolve({topic:"save_response",image:this.exitingWithImage}):void 0;switch(e.topic){case"controls_event":return this.handleControlsEvent(e);case"image_update":return this.handleImageUpdate(e);case"viewport_resize":return this.handleViewportResize(e);case"save_request":return this.handleSaveRequest();case"init_request":return this.handleInitRequest(e);case"remote_process_started":case"remote_process_progress":case"remote_process_complete":if(this.remoteProcessStateMachine&&e.processId===this.remoteProcessCounter)return this.remoteProcessStateMachine.receive(e);throw new Error(`Unsolicited ${e.topic} message received processId: ${e.processId}`);case"presets_request":return this.handlePresetsRequest(e);case"preset_selected":return this.handlePresetSelected(e);default:throw new o.UnreachableError("Unknown message type",e)}})),this.comms=e,this.comms.onMessage(this.onReceiveMessage)}static initialize(e){return r(this,void 0,void 0,(function*(){const t=new MessageChannel,s=new i.IFrameClientBusComms(t.port1),r=new a(s);yield e(r),this.sendWakeUp(t.port2)}))}static sendWakeUp(e){window.parent.postMessage({topic:"wake_up"},"*",[e])}onReady(e){this.readyHandler=e}onControlsEvent(e){this.controlsEventHandler=e}onPresetsRequest(e){this.presetsRequestHandler=e}onPresetSelected(e){this.presetSelectedHandler=e}onSaveRequest(e){this.saveRequestHandler=e}onImageUpdate(e){if(this.imageUpdateHandler)throw new Error("ImageUpdateHandler event handler has already been defined");this.imageUpdateHandler=e}onViewportResize(e){if(this.viewportResizeHandler)throw new Error("ViewportResize event handler has already been defined");this.viewportResizeHandler=e}handleInitRequest(e){return r(this,void 0,void 0,(function*(){try{if(this.readyHandler){const{topic:t}=e,s=n(e,["topic"]);yield this.readyHandler(s)}return{topic:"init_response"}}catch(e){return console.error("[Client] Cannot run the extension:",e.message),console.error(e),{topic:"init_response",error:!0}}}))}overrideThumbnail(e,t){this.comms.castMessage({topic:"thumbnail_override",thumbnailId:e,thumbnail:t})}updateControlPanel(e,t){this.comms.castMessage({topic:"controls_render",controls:e,overlay:t})}handleControlsEvent(e){this.controlsEventHandler&&this.controlsEventHandler(e.message)}handleImageUpdate(e){const{image:t}=e;this.imageUpdateHandler&&this.imageUpdateHandler(t)}handleViewportResize(e){const{size:t,commit:s}=e;this.viewportResizeHandler&&this.viewportResizeHandler(t,s)}handleSaveRequest(){return r(this,void 0,void 0,(function*(){if(!this.saveRequestHandler)throw new Error("Received save request, but no handler configured.");return{topic:"save_response",image:yield this.saveRequestHandler()}}))}handlePresetsRequest(e){return r(this,void 0,void 0,(function*(){if(!this.presetsRequestHandler)throw new Error("Received presets request, but no handler configured.");return{topic:"presets_response",presets:yield this.presetsRequestHandler({minDimensions:e.minDimensions,image:e.image})}}))}handlePresetSelected(e){return r(this,void 0,void 0,(function*(){this.presetSelectedHandler&&this.presetSelectedHandler({presetId:e.presetId})}))}remoteProcess(e,t,s){return r(this,void 0,void 0,(function*(){return new Promise((r,n)=>{this.remoteProcessStateMachine=new c(e=>s&&s(e.inputImageId),e=>t&&t(e.label,e.done,e.total),e=>e.result?r(e.result):n(e.error)),this.comms.castMessage({topic:"start_remote_process",processId:++this.remoteProcessCounter,input:e})})}))}exit(e){this.exitingWithImage=e,this.comms.castMessage({topic:"exit",image:e})}}t.CanvaApiClient=a;class c{constructor(e,t,s){this.onStart=e,this.onProgress=t,this.onComplete=s,this.state="READY",this.startedMessage=void 0,this.progressMessages=[],this.completeMessage=void 0}receive(e){switch(e.topic){case"remote_process_started":if(this.startedMessage)throw new Error(`Receieved too many ${e.topic} messages`);this.startedMessage=e;break;case"remote_process_progress":this.progressMessages.push(e);break;case"remote_process_complete":if(this.completeMessage)throw new Error(`Receieved too many ${e.topic} messages`);this.completeMessage=e;break;default:throw new o.UnreachableError("Unknown message type",e)}this.handleMessages()}handleMessages(){switch(this.state){case"READY":this.startedMessage&&(this.onStart(this.startedMessage),this.state="STARTED",this.handleMessages());break;case"STARTED":this.progressMessages.length>0?(this.onProgress(this.progressMessages[0]),this.progressMessages.shift(),this.handleMessages()):this.completeMessage&&(this.onComplete(this.completeMessage),this.state="DONE");break;case"DONE":break;default:throw new o.UnreachableError("Unknown state",this.state)}}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(3),o=s(4);class i{constructor(e){this.port=e,this.envelopeMinter=new o.Envelope.Minter,this.mailbox=new o.Mailbox({bufferSize:i.MAILBOX_BUFFER_SIZE,timeout:i.MESSAGING_TIMEOUT}),this.messageHandler=new n.EventHandler,this.onPortMessage=e=>{const t=e.data;null!=t.responseToId&&this.mailbox.enqueueMessage(t),this.messageHandler.emit(e)},this.port.onmessage=this.onPortMessage}onMessage(e){this.messageHandler.addEventListener(t=>r(this,void 0,void 0,(function*(){const s=t.data;if(null==s.responseToId){const t=yield e(s.content);t&&this.respondTo(t,s.id)}})))}castMessage(e){this.port.postMessage(this.envelopeMinter.mint(e))}sendMessage(e,t){return r(this,void 0,void 0,(function*(){const s=this.envelopeMinter.mint(e);return this.port.postMessage(s),(yield this.mailbox.receiveReply(s.id,t)).content}))}respondTo(e,t){this.port.postMessage(this.envelopeMinter.mint(e,t))}}t.IFrameClientBusComms=i,i.MAILBOX_BUFFER_SIZE=5,i.MESSAGING_TIMEOUT=5e3},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BUTTON="button",e.COLOR_PICKER="color_picker",e.PAGE="control_panel",e.GROUP="group",e.SELECT="select",e.SLIDER="slider",e.THUMBNAIL_LIST="thumbnail_list",e.TEXT_INPUT="text_input",e.CHECKBOX="checkbox",e.PARAGRAPH="paragraph",e.RADIO_GROUP="radio_group"}(t.ControlName||(t.ControlName={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=e=>Object.assign({type:"select"},e)}(t.Select||(t.Select={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t;!function(e){e.WAKE_UP="wake_up",e.INIT_REQUEST="init_request",e.INIT_RESPONSE="init_response",e.PRESETS_REQUEST="presets_request",e.PRESETS_RESPONSE="presets_response",e.PRESET_SELECTED="preset_selected",e.CONTROLS_RENDER="controls_render",e.CONTROLS_EVENT="controls_event",e.THUMBNAIL_OVERRIDE="thumbnail_override",e.IMAGE_UPDATE="image_update",e.VIEWPORT_RESIZE="viewport_resize",e.SAVE_REQUEST="save_request",e.SAVE_RESPONSE="save_response",e.START_REMOTE_PROCESS="start_remote_process",e.REMOTE_PROCESS_STARTED="remote_process_started",e.REMOTE_PROCESS_PROGRESS="remote_process_progress",e.REMOTE_PROCESS_COMPLETE="remote_process_complete",e.EXIT="exit"}(t=e.Topic||(e.Topic={}))}(t.Message||(t.Message={}))},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);t.HostBus=class{constructor({comms:e}){this.SAVE_TIMEOUT=2e4,this.seq=0,this.thumbnailOverrideHandler=new n.EventHandler,this.controlsRenderHandler=new n.EventHandler,this.saveRequested=!1,this.onReceiveMessage=e=>r(this,void 0,void 0,(function*(){switch(e.topic){case"controls_render":this.controlsRenderHandler.emit(this.seq++,e.controls,e.overlay);break;case"thumbnail_override":this.thumbnailOverrideHandler.emit(e.thumbnailId,e.thumbnail);break;case"start_remote_process":this.handleStartRemoteProcess(e);break;case"exit":this.handleExit(e);break;case"init_response":case"save_response":case"presets_response":throw new Error(`Unsolicited ${e.topic} response received`);default:throw new n.UnreachableError("Unknown message type",e)}})),this.comms=e,e.onMessage(this.onReceiveMessage)}sendInitMessage(e){return r(this,void 0,void 0,(function*(){if((yield this.comms.sendMessage(Object.assign({topic:"init_request"},e))).error)throw new Error("Could not initialize the app")}))}sendControlsEvent(e){this.comms.castMessage({topic:"controls_event",message:e})}sendViewportResize(e,t){this.comms.castMessage({topic:"viewport_resize",commit:t,size:e})}sendImageUpdate(e){this.comms.castMessage({topic:"image_update",image:e})}sendSaveRequest(){return r(this,void 0,void 0,(function*(){return this.saveRequested=!0,(yield this.comms.sendMessage({topic:"save_request"},this.SAVE_TIMEOUT)).image}))}onOverrideThumbnail(e){this.thumbnailOverrideHandler.addEventListener(e)}onUpdateControlPanel(e){this.controlsRenderHandler.addEventListener(e)}onRemoteProcess(e){this.remoteProcessHandler=e}onExit(e){this.exitHandler=e}sendPresetsRequest(e,t){return r(this,void 0,void 0,(function*(){return(yield this.comms.sendMessage({topic:"presets_request",minDimensions:t,image:e})).presets}))}sendPresetSelected(e){this.comms.castMessage({topic:"preset_selected",presetId:e})}handleStartRemoteProcess(e){return r(this,void 0,void 0,(function*(){const{processId:t,input:s}=e;if(!this.remoteProcessHandler)throw new Error("Received remote process request with no handler registered");const{inputImageId:r,result:n}=this.remoteProcessHandler(s,(e,s,r)=>{this.comms.castMessage({topic:"remote_process_progress",processId:t,label:e,done:s,total:r})}),o=yield r;this.comms.castMessage({topic:"remote_process_started",processId:t,inputImageId:o});try{const e=yield n;this.comms.castMessage({topic:"remote_process_complete",processId:t,result:e})}catch(e){this.comms.castMessage({topic:"remote_process_complete",processId:t,error:e})}}))}handleExit(e){if(!this.exitHandler)throw new Error("EXIT called, but no handler registered");this.saveRequested||this.exitHandler(e.image)}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(22);t.connect=function(e){return r(this,void 0,void 0,(function*(){return new Promise((t,s)=>{try{const s=r=>{const o=r.data;if(r.source!==e.contentWindow||"wake_up"!==o.topic)return;const[i]=r.ports;window.removeEventListener("message",s),t(new n.IFrameHostBusComms(i))};window.addEventListener("message",s)}catch(e){s(e)}})}))}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(0);class o{constructor(e){this.port=e,this.mailbox=new n.Mailbox({bufferSize:o.MAILBOX_BUFFER_SIZE,timeout:o.MESSAGING_TIMEOUT}),this.envelopeMinter=new n.Envelope.Minter,this.messageHandler=new n.EventHandler,this.onPortMessage=e=>{const t=e.data;null!=t.responseToId&&this.mailbox.enqueueMessage(t),this.messageHandler.emit(e)},this.port.onmessage=this.onPortMessage}onMessage(e){this.messageHandler.addEventListener(t=>r(this,void 0,void 0,(function*(){const s=t.data;if(null==s.responseToId){const t=yield e(s.content);t&&this.respondTo(t,s.id)}})))}castMessage(e){this.port.postMessage(this.envelopeMinter.mint(e))}sendMessage(e,t){return r(this,void 0,void 0,(function*(){const s=this.envelopeMinter.mint(e);return this.port.postMessage(s),(yield this.mailbox.receiveReply(s.id,t)).content}))}respondTo(e,t){this.port.postMessage(this.envelopeMinter.mint(e,t))}}t.IFrameHostBusComms=o,o.MAILBOX_BUFFER_SIZE=5,o.MESSAGING_TIMEOUT=5e3}])}));